
<!DOCTYPE html>
<html lang="en">
	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1 shrink-to-fit=no">
		<meta name="referrer" content="unsafe-url">

		<title>Log In - votezilla</title>

		<link rel="stylesheet" type="text/css" href="/static/style.css?1ds32233728978978dddsdsdsdsss">




		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>





	</head>
	<body id="override">


	<div class="smart-padding container vz-container">
		<div class="row vz-row">
			<div class="col-md-3 vz-col-md-3"></div>
			<div class="col-md-6 vz-col-md-6" style="max-width: 500px;">


	<table id="hnmain" border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: #f6f6ef">

		<tr><td bgcolor="#ff6600">
			<div width=100% style="background-color:white"><img src='/static/votezilla logo/votezilla 6.jpg' class="center" style="max-width:100%"></div>
		</td></tr>

		<tr><td bgcolor=white>
			<table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px">
				<tr>
					<td style="width:18px; padding:1px">
						<div style="border: 1px solid black; color: black; text-align:center;"><span style="color:#ff009c">v</span><span style="color:#0072ff">z</span></div>
					</td>
					<td style="line-height:12pt; height:10px; padding: 0px 5px; color:white !important;">
						<span class="pagetop">

							<b class="hnname">
								<a href="news" style="color:#ff009c">vote<span style="color:black">zilla</span></a>
							</b>
						<a href="/news" style="color:black;">news</a> | <a href="/create" style="color:black;">create</a> | <a href="/history" style="color:black;">history</a></span>
					</td>
					<td style="text-align:right; padding-right:4px;">
						<span class="pagetop">
							<a href="/login">log in</a>
								/
							<a href="/register">sign up</a>
						</span>
					</td>
				</tr>
			</table>
		</td></tr>
	</table>


    login.htmllll
	<div><form method="POST" action="/login">


	<input type="text" name="emailOrUsername" value="" placeholder="Email / Username" length="50" class="nuField">

	<input type="password" name="password" value="" placeholder="Password" length="50" class="nuField">

		<p class="nuFieldSubtext">
			<a href="onClick_OpenModalLink('forgotAccountTarget')">
				Forgot Account?
				<a id="forgotAccountTarget" data-target="#myModal" data-toggle="modal" data-path="forgotAccount" data-title="Forgot Account"></a>
			</a>
		</p>
		<p>

	<div>
		<button type="submit" class="nuBtn btn btn-vote center">
			Log In
		</button>
	</div>

		<div class="nuFooter">
			New to Votezilla?
			<a onclick="onClick_OpenModalLink('registerTarget')" class="storylink" rel="nofollow" style="color:blue; cursor: pointer">
				SIGN UP
				<a id="registerTarget" data-target="#myModal" data-toggle="modal" data-path="register" data-title="Sign Up"></a>
			</a>
		</div>
		<br>
	</form></div>


			</div>
			<div class="col-md-3 vz-col-md-3"></div>
		</div>
	</div>



<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header" style="background-color:#edf0f5">
				<h1 class="modal-title" id="myModalLabel" style="align:center;">
					Sign Up
				</h1>
				<button type="button" class="btn btn-default" data-dismiss="modal"
						style="font-size: 40px; padding: 0; position:absolute; right:20px; cursor: pointer !important; border-radius: 2rem; background-color:#edf0f5;">
					&times;
				</button>
			</div>

			<div class="modal-body" style="background-color:white"></div>
		</div>
	</div>
</div>

<script>








$('#myModal').on('show.bs.modal', function(e) {
	var rt = $(e.relatedTarget);

	var path = rt.data('path');

	if (path == null) {
		alert("Modal's data-path parameter is null.");
		return;
	}

	console.log("path = " + path);

	var title = rt.data('title');
	console.log("title = " + title);
	$('.modal-title').text(title);


	if (window[path + "_Modal"] != null) {
		window[path + "_Modal"](rt);
		return;
	}

	$('.modal-body').load(`/${path}/`, function() { // works, now also testing...
		console.log('Load was performed');

		$('.modal').modal({show: true});
	});
});







loggedIn =  false  ;

var votedPosts = [[], []];

function removeItem(arr, item) {
	var index = arr.indexOf(item);
	if (index > -1) {
	    arr.splice(index, 1);
	}
}


function hasVote(id, up) {
	return votedPosts[up ? 1 : 0].includes(id)
}


function addOrRemoveVoteState(id, add, up) {
	if (add) {
		votedPosts[up ? 1 : 0].push(id)

	} else {
		removeItem(votedPosts[up ? 1 : 0], id)
	}
}


function incVoteLabel(id, voteInc) {
	label = $("#votetally" + id)
	count = parseInt(label.text())
	label.text(count + voteInc)
}


function addOrRemoveVote(id, add, up, updateDatabase, updateText) {

	addOrRemoveVoteState(id, add, up)


	if (add) {
		if (up) {
			$("#upvote" + id).addClass("upvoted")
		} else {
			$("#downvote" + id).addClass("downvoted")
		}
	} else {
		if (up) {
			$("#upvote" + id).removeClass("upvoted")
		} else {
			$("#downvote" + id).removeClass("downvoted")
		}
	}


	if (updateText) {
		incVoteLabel(id, (add && up || !add && !up) ? 1 : -1)
	}


	if (updateDatabase) {
		$.ajax({
			url: '/ajaxVote/',
			type: "post",
			contentType: 'application/json; charset=utf-8',
			data: JSON.stringify({PostId: id, Add: add, Up: up}),
			dataType: 'json',
			success: function(r) { console.log("AJAX - success"); },
			error:   function(r) { console.log("AJAX - error"); }
		});
	}
}


function cancelVote(id, up) {
	if (hasVote(id, up)) {
		addOrRemoveVote(id, false, up, false, true)
	}
}



function toggleVote(id, up) {
	if (hasVote(id, up)) {
		addOrRemoveVote(id, false, up, true, true)
	} else {
		addOrRemoveVote(id, true,  up, true, true)
	}
}






function Vote(id, up) {
	if (loggedIn) {
		cancelVote(id, !up)
		toggleVote(id, up)
	} else {
		alert("You must be logged in to do that!")
	}
}

$(function() {


});









function getVoteData(pollId, pollType) {
	console.log(`getVoteData(${pollId}, ${pollType})`);

	var numOptions = $('input[name="vote_' + pollId + '_len"]').val();

	console.log(`numOptions = ${numOptions}`);

	var voteData = [];

	for (var o = 0; o < numOptions; o++) {
		switch(pollType) {
			case "radio":
			case "checkbox":
				voteData.push($(`#vote_${pollId}_${o}`).is(':checked') ? "x" : "");
				break;
			case "text":
				voteData.push($(`#vote_${pollId}_${o}`).val());
				break;
			default:
				alert("Unhandled poll type AAA: " + pollType);
		}
	}
	console.log(voteData);

	return voteData;
}

function ordinal(num) {
	switch(num) {
		case 1: return "1st";
		case 2: return "2nd";
		case 3: return "3rd";
		default: return `${num}th`;
	}
}

function validateVoteData(pollType, voteData) {
	switch(pollType) {
		case "radio":
		case "checkbox":
			console.log(voteData);

			valid = voteData.reduce((a, b) => a || b)
			console.log("valid = " + valid);

			if (!valid) {
				alert(`You must select ${pollType == "checkbox" ? "at least " : ""}one option`);
			}

			return valid;
		case "text":
			sorted = voteData.filter(x => x != "").sort();

			console.log(voteData);
			console.log(sorted);


			if (sorted[0] != "1") {
				alert('You must mark your 1st choice with a "1"');
				return false;
			}
			var gap = false;
			for (var i = 1; i < sorted.length; i++) {
				if (sorted[i] != (i + 1).toString(10)) {
					alert(`You must mark your ${ordinal(i + 1)} choice with a "${i + 1}" (if you care to pick one).`);
					console.log("return false");
					return false;
				}
			}
			console.log("return true");
			return true;
		default:
			alert("Unhandled poll type BBB: " + pollType);
			return false;
	}
}


function viewPollResults_Modal(rt) {
	if ( -1  == -1) {
		alert("You must be logged in to do that!");


		$('#myModal').modal('dispose');

		return;
	}


	var pollId	 = rt.data('poll-id');
	var pollType = rt.data('poll-type');

	console.log("pollId = " + pollId);
	console.log("pollType = " + pollType);
	console.log("userId = " +  -1 );

	voteData = getVoteData(pollId, pollType);

	console.log({PollId: pollId, VoteData: voteData});

	if (validateVoteData(pollType, voteData)) {
		console.log("valid vote data");

		$(this).find('.modal-body').css({
			'max-height': '100%'
		});


		$.ajax({
			url: '/ajaxPollVote/',
			type: "post",
			contentType: 'application/json; charset=utf-8',
			data: JSON.stringify({PollId: pollId, VoteData: voteData}),
			dataType: 'json',
			success: function(r) {
				console.log("AJAX Poll Vote - success");

				console.log(r);


				$('.modal-body').load(`/viewPollResults/?postId=${pollId}&voteData=${voteData}`, function() {
					console.log('Load was performed');
				});
			},
			error: function(r) {
				console.log("AJAX Poll Vote - error");

				alert("Vote failed for some reason.");


				$('#myModal').modal('dispose');
			}
		});
	} else {

		console.log("invalid vote data, disposing of modal");

		$('#myModal').modal('dispose');
	}
}






var triggerModalDataTargetAnchor = "";


function onClick_OpenModalLink(modalDataTargetAnchor) {
	console.log("onClick_OpenModalLink: modalDataTargetAnchor = " + modalDataTargetAnchor);

	triggerModalDataTargetAnchor = modalDataTargetAnchor;
	$('#myModal').modal('hide');
}


$('#myModal').on('hidden.bs.modal', function (e) {
	if (triggerModalDataTargetAnchor) {
		$( "#myModal" ).modal( "show", $( "#"+triggerModalDataTargetAnchor ) );

		triggerModalDataTargetAnchor = "";
	}
})




</script>



		<script>




		 	""
		</script>
	</body>
</html>
